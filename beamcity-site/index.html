<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BeamTown - Новогодний Discord!</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<style>
/* --- СТИЛИ CSS --- */

body, html { margin:0; padding:0; font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; overflow-x:hidden; height:100%; background:#0a0a1a; color:#fff; }

/* --- Общие новогодние стили --- */
body {
    background: linear-gradient(to bottom, #0f2027, #203a43, #2c5364); 
    background-size: cover;
    background-attachment: fixed;
    position: relative;
}

/* Эффект падающего снега (фоновый, остается всегда) */
.snowflake {
  color: #fff;
  font-size: 1em;
  font-family: Arial, sans-serif;
  text-shadow: 0 0 5px #000;
  position: fixed;
  top: -10%;
  z-index: 9999;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
  cursor: default;
  animation-name: snowfall;
  animation-duration: 10s;
  animation-timing-function: linear;
  animation-iteration-count: infinite;
}
@keyframes snowfall {
  0% { top: -10%; }
  100% { top: 100%; }
}

/* ------------------------------------------- */
/* --- СТИЛИ ДЛЯ МЕТЕЛИ (СНЕЖНОГО ПЕРЕХОДА) --- */
/* ------------------------------------------- */
#snow-transition {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    opacity: 0;
    z-index: 2000;
    pointer-events: none;
    background: transparent;
    transition: opacity 0.3s ease-out;
}
#snow-transition.active {
    opacity: 1;
    pointer-events: auto;
    background: #ffffff; 
    transition: opacity 0s; 
}
#snow-transition.fade-out {
    opacity: 0 !important;
    transition: opacity 1s ease-out 0.2s; 
}

/* Стилизация снежинок для метели */
.blizzard-flake {
    position: absolute;
    color: #000; 
    font-size: 4em; 
    text-shadow: 0 0 15px rgba(255, 255, 255, 0.8);
    opacity: 0; 
    animation: blizzard-fall 4s linear forwards; 
}

@keyframes blizzard-fall {
    0% {
        transform: translate(-10vw, -100vh) scale(0.5); 
        opacity: 0;
    }
    10% {
        opacity: 1; 
    }
    100% {
        transform: translate(30vw, 100vh) scale(1.2); 
        opacity: 0; 
    }
}
/* ------------------------------------------- */
/* --- Конец СТИЛЕЙ ДЛЯ МЕТЕЛИ --- */
/* ------------------------------------------- */

/* --- СТИЛИ РЕГУЛИРОВКИ ЗВУКА --- */
.volume-control {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 1000;
    display: flex;
    align-items: center;
    background: rgba(0, 0, 0, 0.5);
    padding: 10px 15px;
    border-radius: 10px;
    backdrop-filter: blur(5px);
    border: 1px solid rgba(255, 255, 255, 0.2);
}
.volume-control button {
    background: none;
    border: none;
    color: #fff;
    font-size: 1.5em;
    cursor: pointer;
    margin-right: 10px;
    transition: color 0.3s;
    line-height: 1;
}
.volume-control button:hover {
    color: #00ffcc;
}
.volume-control input[type="range"] {
    -webkit-appearance: none;
    appearance: none;
    width: 100px;
    height: 8px;
    background: #555;
    border-radius: 5px;
    outline: none;
    transition: opacity .2s;
}
.volume-control input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 16px;
    height: 16px;
    border-radius: 50%;
    background: #00ffcc;
    cursor: pointer;
}
.volume-control input[type="range"]::-moz-range-thumb {
    width: 16px;
    height: 16px;
    border-radius: 50%;
    background: #00ffcc;
    cursor: pointer;
    border: none;
}
/* --- КОНЕЦ СТИЛЕЙ РЕГУЛИРОВКИ ЗВУКА --- */


/* --- Overlay с техработами --- */
#overlay { 
    position:fixed; 
    top:0; 
    left:0; 
    width:100%; 
    height:100%; 
    background: linear-gradient(to bottom, #0f2027, #203a43, #2c5364); 
    display:flex; 
    flex-direction:column; 
    align-items:center; 
    justify-content:center; 
    text-align:center; 
    z-index:1000;
    transition: opacity 0.7s ease-out; /* Добавлено для плавного исчезновения содержимого */
}
#overlay .logo { 
    font-size:3em; 
    font-weight:bold; 
    color:#00ffcc; 
    text-shadow:0 0 40px #00ffcc,0 0 80px #33ccff; 
    animation:pulse 2s infinite; 
    margin-bottom:20px; 
    padding: 0; 
    border-radius: 0;
    background: transparent; 
}
@keyframes pulse {0%,100%{transform:scale(1);}50%{transform:scale(1.1);}}
#overlay .loading-line { font-size:1.3em; margin:5px 0; opacity:0; transition: opacity 0.3s; color:#e0f7fa; }
#overlay .loading-line.show { opacity:1; }
#overlay .dots { display:inline-block; animation: blink 1s infinite; }
@keyframes blink {0%,50%,100%{opacity:0;}25%,75%{opacity:1;}}

/* --- Основной сайт --- */
#main { display:none; }
canvas#bg { position:fixed; top:0; left:0; width:100%; height:100%; z-index:-1; }
header { text-align:center; padding:120px 20px 80px; color:#fff; text-shadow:0 0 15px #e0f7fa; perspective:1000px; }
header .logo { 
    width: auto; 
    height: auto; 
    padding: 15px 40px; 
    margin:0 auto 25px; 
    border-radius:50px; 
    display:inline-flex; 
    align-items:center; 
    justify-content:center; 
    font-size:2.5em; 
    font-weight:bold; 
    background: radial-gradient(circle,#00ffcc,#33ccff); 
    box-shadow:0 0 50px #00ffcc,0 0 80px #33ccff; 
    animation: pulse 2s infinite; 
    letter-spacing: 3px; 
}
@keyframes pulse {0%,100%{transform:scale(1);}50%{transform:scale(1.1);}}
h1 { font-size:3.2em; margin-bottom:15px; text-transform:uppercase; letter-spacing:2px; color:#e0f7fa; }
p { font-size:1.2em; max-width:700px; margin:0 auto 50px; opacity:0.9; line-height:1.5em; color:#cfe8fc; }

.countdown {
    margin-top: 20px;
    font-size: 2em;
    font-weight: bold;
    color: #ff6b6b;
    text-shadow: 0 0 20px rgba(255, 107, 107, 0.8), 0 0 10px rgba(255, 107, 107, 0.5);
    display: flex;
    justify-content: center;
    gap: 15px;
    letter-spacing: 1px;
}
.countdown div {
    text-align: center;
    padding: 10px 15px;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 8px;
    border: 1px solid rgba(255, 107, 107, 0.5);
}
.countdown span {
    display: block;
    font-size: 0.4em;
    font-weight: normal;
    color: #cfe8fc;
    margin-top: 5px;
}

.section { max-width:850px; margin:50px auto; text-align:center; color:#e0f7fa; display:flex; flex-direction:column; gap:25px; }
.card { background:rgba(255,255,255,0.1); padding:25px; border-radius:20px; box-shadow:0 0 30px rgba(0,255,204,0.3); transition: transform 0.3s, box-shadow 0.3s; border: 1px solid rgba(255,255,255,0.2); }
.card:hover { transform: translateY(-10px) scale(1.02); box-shadow:0 0 50px rgba(0,255,204,0.6); }

.main-buttons {
    display: flex;
    justify-content: center; 
    align-items: center;
    gap: 20px;
    margin-top: 20px; 
    flex-wrap: wrap;
    max-width: 900px; 
    margin-left: auto;
    margin-right: auto;
}
.btn { 
    flex-grow: 1; 
    min-width: 250px; 
    padding:18px 35px; 
    color:#fff; 
    font-weight:bold; 
    border-radius:50px; 
    text-decoration:none; 
    transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
    box-shadow:0 0 15px rgba(103, 58, 183, 0.7); 
    border: none;
    cursor: pointer;
    font-size: 1.1em; 
    text-align: center;
    display: inline-flex; 
    align-items: center;
    justify-content: center;
    gap: 10px;
}
.btn-discord {
    background:#673ab7; 
}
.btn-discord:hover {
    transform:translateY(-5px) scale(1.05); 
    background:#512da8; 
    box-shadow:0 0 30px rgba(103, 58, 183, 1), 0 10px 20px rgba(0,0,0,0.2); 
}
.btn-quiz {
    background: #FF5722; 
    box-shadow: 0 0 15px rgba(255, 87, 34, 0.7); 
}
.btn-quiz:hover {
    transform:translateY(-5px) scale(1.05); 
    background:#E64A19; 
    box-shadow:0 0 30px rgba(255, 87, 34, 1), 0 10px 20px rgba(0,0,0,0.2); 
}

footer { text-align:center; padding:20px; background:rgba(0,0,0,0.6); color:#b0bec5; margin-top:40px; }

.social-links {
    margin: 15px 0 10px;
    display: flex;
    justify-content: center;
    gap: 20px;
}
.social-link {
    text-decoration: none;
    font-size: 1.1em;
    font-weight: bold;
    padding: 10px 20px;
    border-radius: 8px;
    transition: transform 0.3s, opacity 0.3s;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.3);
}
.social-link:hover {
    transform: translateY(-3px);
    opacity: 0.9;
}
.vk-link {
    background: #4a76a8; 
    color: white;
}
.tg-link {
    background: #0088cc; 
    color: white;
}
.social-icon { 
    font-size: 1.3em; 
    line-height: 1; 
}

.fade-up { opacity:0; transform:translateY(30px); animation: fadeUp 1s forwards; }
@keyframes fadeUp { to {opacity:1; transform:translateY(0);} }
.under-construction { background:rgba(255,100,100,0.15); border:2px dashed #ff6b6b; padding:25px; border-radius:20px; font-size:1.2em; color:#ff6b6b; animation: pulseText 2s infinite; }
@keyframes pulseText {0%,100%{opacity:1;}50%{opacity:0.6;}}

.grid-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-top: 20px;
    text-align: left;
}
.grid-item {
    background: rgba(45, 45, 70, 0.9);
    padding: 20px;
    border-radius: 15px;
    box-shadow: 0 0 20px rgba(0, 217, 255, 0.2);
    border-left: 5px solid #00ffcc;
    transition: all 0.3s;
}
.grid-item:hover {
    transform: translateY(-5px);
    box-shadow: 0 0 35px rgba(0, 217, 255, 0.4);
}
.grid-item h3 {
    color: #00ffcc;
    font-size: 1.3em;
    margin-top: 0;
}
.grid-item p {
    font-size: 0.95em;
    margin: 0;
    line-height: 1.4;
    color: #cfe8fc;
}

.modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.85);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 1001;
    backdrop-filter: blur(5px);
    opacity: 0;
    transition: opacity 0.7s ease-out; 
    transform: scale(0.8);
}
.modal-overlay.show {
    display: flex;
    opacity: 1;
    transform: scale(1);
}
.modal-content {
    background: #1e3a4e; 
    padding: 40px;
    border-radius: 15px;
    text-align: center;
    max-width: 450px;
    box-shadow: 0 0 60px rgba(100, 255, 255, 0.6); 
    border: 1px solid #99ffff; 
    max-height: 90vh; 
    overflow-y: auto;
    position: relative; 
}

/* СТИЛЬ КРЕСТИКА */
.close-btn {
    position: absolute;
    top: 15px;
    right: 15px;
    background: none;
    border: none;
    color: #ff6b6b; 
    font-size: 2em;
    font-weight: bold;
    cursor: pointer;
    line-height: 1;
    padding: 0;
    transition: transform 0.3s, color 0.3s;
}
.close-btn:hover {
    color: #ff3333;
    transform: rotate(90deg);
}

.modal-content h2 {
    color: #00ffcc;
    margin-top: 0;
    margin-bottom: 25px;
}
.modal-content h3 {
    color: #e0f7fa;
    margin-top: 0;
    margin-bottom: 20px;
    font-size: 1.3em;
}

.options-container button {
    display: block;
    width: 100%;
    padding: 15px 20px;
    margin-bottom: 15px;
    background: #006080; 
    color: #fff;
    font-weight: bold;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    transition: all 0.3s ease-in-out; 
    font-size: 1.1em;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
}
.options-container button:hover:not(.disabled) {
    background: #008cba; 
    transform: translateY(-3px) scale(1.02); 
    box-shadow: 0 6px 15px rgba(0, 140, 186, 0.5); 
}

.quiz-options button.correct {
    background: #4CAF50; 
    box-shadow: 0 0 15px rgba(76, 175, 80, 0.8);
    transform: scale(1.05);
}
.quiz-options button.incorrect {
    background: #F44336; 
    box-shadow: 0 0 15px rgba(244, 67, 54, 0.8);
}
.quiz-options button.disabled {
    cursor: default;
    opacity: 0.6;
}

#next-quiz-btn {
    margin-top: 20px;
    padding: 12px 30px;
    font-size: 1em;
    background: #00ffcc; 
    color: #1e3a4e;
    font-weight: bold;
    border: none;
    border-radius: 50px;
    cursor: pointer;
    transition: all 0.3s;
    display: none;
}
#next-quiz-btn:hover {
    background: #33ccff;
    transform: scale(1.05);
}

/* СТИЛЬ КНОПКИ ПОДАРКА */
.btn-gift {
    background: linear-gradient(135deg, #FF6F00 0%, #FFB300 100%); 
    color: #1a1a1a;
    box-shadow: 0 0 15px rgba(255, 111, 0, 0.7); 
}
.btn-gift:hover {
    transform:translateY(-5px) scale(1.05); 
    background: linear-gradient(135deg, #E65100 0%, #FF6F00 100%); 
    box-shadow:0 0 30px rgba(255, 111, 0, 1), 0 10px 20px rgba(0,0,0,0.2); 
}

/* СТИЛИ: АНИМИРОВАННЫЙ ГРАДИЕНТ ДЛЯ ЛОГОТИПА */
header .logo.animated {
    background: linear-gradient(135deg, #00ffcc, #33ccff, #ff6b6b, #00ffcc);
    background-size: 400% 400%;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    animation: gradient-flow 5s ease infinite, pulse 2s infinite; 
    box-shadow: none !important; 
}
.logo.animated:hover {
    animation-play-state: running;
}
@keyframes gradient-flow {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}
</style>
</head>
<body onload="initPage()">

<div id="snow-transition"></div>

<div class="volume-control">
    <button id="mute-btn" onclick="toggleMute()"><i class="fas fa-volume-mute"></i></button>
    <input type="range" id="volume-slider" min="0" max="100" value="30">
</div>
<div id="survey-modal" class="modal-overlay">
    <div class="modal-content survey-content">
        <button class="close-btn" onclick="closeModal('survey-modal')">&times;</button> 
        <h2>Откуда вы узнали о BeamTown?</h2>
        <div class="options-container survey-options">
            <button class="survey-btn" data-source="TikTok">Из TikTok-ролика</button>
            <button class="survey-btn" data-source="Friend">От друга / знакомого</button>
            <button class="survey-btn" data-source="Random">Нашел(а) случайно в Интернете</button>
        </div>
    </div>
</div>

<div id="quiz-modal" class="modal-overlay">
    <div class="modal-content quiz-content">
        <button class="close-btn" onclick="closeModal('quiz-modal')">&times;</button> 
        <h2>Новогодний Тест на BeamNG Знания</h2>
        <div id="quiz-question-container">
            </div>
        <button id="next-quiz-btn">Следующий вопрос</button>
    </div>
</div>

<div id="gift-modal" class="modal-overlay">
    <div class="modal-content prediction-content" style="max-width: 500px; background: #263238;">
        <button class="close-btn" onclick="closeModal('gift-modal')">&times;</button> 
        <h2>✨ Ваш Тайный Новогодний Подарок! ✨</h2>
        <p style="font-size: 1.1em; color: #b0bec5; margin-bottom: 25px;">
            Используйте этот уникальный код в специальном канале на нашем Discord-сервере, чтобы получить эксклюзивную роль и небольшой сюрприз!
        </p>
        <div id="secret-code" style="font-size: 2em; margin: 30px 0; padding: 15px; border: 3px solid #FFD700; background: #000; border-radius: 10px; color: #FFD700; font-weight: bold; text-shadow: 0 0 10px #FFD700;">
            NT-BEAMTOWN-2026
        </div>
        <p style="font-size: 0.9em; color: #cfd8dc;">
            Скопируйте код и введите его в канал **#новогодние-подарки** на сервере BeamTown!
        </p>
    </div>
</div>
<div id="overlay">
    <div class="logo">BEAMTOWN</div>
    <div class="loading-line">Дедушка Мороз готовит BeamTown к праздникам<span class="dots">...</span></div>
    <div class="loading-line">Насыпаем снег на сервера<span class="dots">...</span></div>
    <div class="loading-line">Развешиваем гирлянды и мишуру<span class="dots">...</span></div>
    <div class="loading-line">Готовим новогодние подарки и сюрпризы<span class="dots">...</span></div>
    <div class="loading-line">Скоро засияет новогодняя магия<span class="dots">...</span></div>
</div>

<div id="main">
<canvas id="bg"></canvas>

<header>
    <div class="logo animated fade-up" style="animation-delay:0.2s;">BEAMTOWN</div>
    <h1 class="fade-up" style="animation-delay:0.5s;">BeamTown - С Новым Годом!</h1>
    <p class="fade-up" style="animation-delay:0.8s;">Добро пожаловать в новогодний BeamTown Discord! Приготовьтесь к праздничному веселью, эксклюзивным подаркам и самым ярким событиям года. Присоединяйтесь к нашему дружному сообществу и встречайте Новый Год вместе!</p>
    
    <h2 class="fade-up" style="animation-delay:1s; color:#e0f7fa; font-size:1.5em; margin-bottom: 5px;">ДО НОВОГО ГОДА ОСТАЛОСЬ:</h2>
    <div class="countdown fade-up" style="animation-delay:1.2s;" id="timer">
        </div>
    </header>

<section class="section fade-up" style="animation-delay:1.5s;">      
    <div class="card">🎄 <strong>Новогодние конкурсы и подарки:</strong> участвуй и выигрывай эксклюзивные призы!</div>
    <div class="card">🎁 <strong>Тайный Санта BeamTown:</strong> обменивайся подарками с друзьями по всему серверу.</div>
    <div class="card">❄️ <strong>Зимние гонки и приключения:</strong> новые карты и режимы для праздничного настроения.</div>
    <div class="card">💬 <strong>Праздничное общение:</strong> найди новых друзей и отметь Новый Год вместе с нами!</div>
    <div class="card">✨ <strong>Волшебная атмосфера:</strong> окунись в мир новогоднего веселья и сюрпризов.</div>
    
    <div class="main-buttons">
        <a href="https://discord.gg/SXvWhTwC" target="_blank" class="btn btn-discord">
            <i class="fab fa-discord"></i> Зайти в новогодний Discord!
        </a>
        <button id="open-gift-btn" class="btn btn-gift">
            <i class="fas fa-key"></i> Тайный подарок
        </button>
        <button id="open-quiz-btn" class="btn btn-quiz">BeamNG Drive Викторина</button>
    </div>
</section>

<section class="section fade-up" style="animation-delay:1.7s;"> <h2>⚙️ Команда BeamTown и правила</h2>
    <div class="grid-container">
        <div class="grid-item">
            <h3>⭐ Модератор: melo</h3>
            <p><strong>Обязанности:</strong> Следит за порядком в гоночных каналах, организует зимние заезды и решает споры.</p>
        </div>
        <div class="grid-item">
            <h3>🛠️ Администратор: nexo</h3>
            <p><strong>Обязанности:</strong> Управляет RP-ивентами, отвечает за техническое состояние сервера и бан-лист.</p>
        </div>
        <div class="grid-item">
            <h3>🚨 Правило: RP-поведение</h3>
            <p>Строго соблюдайте RolePlay в специально отведенных каналах. Non-RP в RP-каналах запрещен.</p>
        </div>
        <div class="grid-item">
            <h3>🚫 Правило: Запрет читов</h3>
            <p>Любое использование стороннего ПО, дающего преимущество, ведет к немедленному перманентному бану.</p>
        </div>
    </div>
</section>
<section class="section fade-up" style="animation-delay:1.9s;">       <div class="under-construction">
        ❄️ Сайт BeamTown сияет новогодней магией! Мы постоянно добавляем новые праздничные фишки и возможности.
    </div>
</section>

<footer>
    <div class="social-links">
        <a href="https://vk.com/id734541588" target="_blank" class="social-link vk-link">
            <i class="fab fa-vk social-icon"></i> ВКонтакте
        </a>
        <a href="https://discord.gg/SXvWhTwC" target="_blank" class="social-link" style="background: #5865F2; color: white;">
            <i class="fab fa-discord social-icon"></i> Discord
        </a>
        <a href="#" target="_blank" class="social-link tg-link">
            <i class="fab fa-telegram-plane social-icon"></i> Telegram
        </a>
    </div>
    &copy; 2025 BeamTown Discord. Счастливого Нового Года!
</footer>
</div>

<div id="yt-player" style="position: absolute; left: -9999px; top: -9999px;"></div>

<script>
    var tag = document.createElement('script');
    tag.src = "https://www.youtube.com/iframe_api";
    var firstScriptTag = document.getElementsByTagName('script')[0];
    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
</script>

<script>

// --- ФУНКЦИЯ ЗАПУСКА СТРАНИЦЫ ---
function initPage() {
    startCountdown(); // Запускаем таймер
    stagedLoading();  // Запускаем последовательность загрузки, которая в итоге покажет сайт
}

// --- ЛОГИКА СКРЫТИЯ OVERLAY (ЭКРАНА ЗАГРУЗКИ) ---

/**
 * Плавно скрывает экран загрузки и показывает основной контент.
 */
function showMainContent() {
    const overlay = document.getElementById('overlay');
    const main = document.getElementById('main');
    
    // 1. Плавно скрываем содержимое overlay. 
    overlay.style.opacity = '0'; 

    setTimeout(() => {
        // 2. Показываем основной контент и окончательно убираем overlay.
        overlay.style.display = 'none'; // Убираем overlay окончательно
        main.style.display = 'block'; // Показываем основной контент
        
        // Запускаем музыку, так как пользователь теперь видит сайт.
        startMusic(); 
    }, 700); // 700ms - время, пока исчезает содержимое overlay (равно CSS transition)
}


function stagedLoading() {
    const lines = document.querySelectorAll('#overlay .loading-line');
    lines.forEach((line, index) => {
        // Постепенно показываем линии с задержкой
        setTimeout(() => {
            line.classList.add('show');
            if (index === lines.length - 1) {
                // После показа последней линии, ждем и просто скрываем overlay.
                setTimeout(showMainContent, 1500); 
            }
        }, index * 800); 
    });
}


// --- YOUTUBE МУЗЫКАЛЬНЫЙ ПЛЕЕР И УПРАВЛЕНИЕ ЗВУКОМ ---
let player;
let isMuted = true; 

function onYouTubeIframeAPIReady() {
    player = new YT.Player('yt-player', {
        height: '1',
        width: '1',
        videoId: 'Rnil5LyK_B0', 
        playerVars: {
            'autoplay': 0,
            'controls': 0, 
            'loop': 1, 
            'playlist': 'Rnil5LyK_B0', 
            'mute': 1, 
            'disablekb': 1,
            'fs': 0,
            'iv_load_policy': 3
        },
        events: {
            'onReady': onPlayerReady
        }
    });
}

function onPlayerReady(event) {
    const initialVolume = parseInt(document.getElementById('volume-slider').value);
    player.setVolume(initialVolume);
    
    document.getElementById('volume-slider').addEventListener('input', setVolumeFromSlider);
    
    document.getElementById('mute-btn').querySelector('i').className = 'fas fa-volume-mute';
}

function startMusic() {
    if (player && typeof player.playVideo === 'function') {
        if (isMuted) {
            player.unMute(); 
            isMuted = false;
            document.getElementById('mute-btn').querySelector('i').className = 'fas fa-volume-up';
        }
        player.playVideo(); 
    }
}

function setVolumeFromSlider() {
    const volume = parseInt(this.value);
    if (player && typeof player.setVolume === 'function') {
        player.setVolume(volume);
        if (volume > 0) {
            if (isMuted) {
                player.unMute();
                isMuted = false;
                player.playVideo(); 
            }
            document.getElementById('mute-btn').querySelector('i').className = 'fas fa-volume-up';
        } else {
            player.mute();
            isMuted = true;
            document.getElementById('mute-btn').querySelector('i').className = 'fas fa-volume-off';
        }
    }
}

function toggleMute() {
    if (!player || typeof player.isMuted !== 'function') return;

    if (isMuted) {
        // Unmute
        player.unMute();
        player.playVideo(); 
        isMuted = false;
        document.getElementById('mute-btn').querySelector('i').className = 'fas fa-volume-up';
        
        // Если громкость была на 0, устанавливаем ее на 30
        const slider = document.getElementById('volume-slider');
        if (slider.value == 0) {
            slider.value = 30; 
            player.setVolume(30);
        }

    } else {
        // Mute
        player.mute();
        isMuted = true;
        document.getElementById('mute-btn').querySelector('i').className = 'fas fa-volume-mute';
    }
}


// --- JS ДЛЯ ТАЙМЕРА ОБРАТНОГО ОТСЧЕТА ---
function startCountdown() {
    const newYearDate = new Date("Jan 1, 2026 00:00:00").getTime(); 
    const timerElement = document.getElementById("timer");

    const updateTimer = setInterval(function() {
        const now = new Date().getTime();
        const distance = newYearDate - now;

        const days = Math.floor(distance / (1000 * 60 * 60 * 24));
        const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((distance % (1000 * 60)) / 1000);

        timerElement.innerHTML = `
            <div>${days.toString().padStart(2, '0')}<span>ДНИ</span></div>
            <div>${hours.toString().padStart(2, '0')}<span>ЧАСЫ</span></div>
            <div>${minutes.toString().padStart(2, '0')}<span>МИНУТЫ</span></div>
            <div>${seconds.toString().padStart(2, '0')}<span>СЕКУНДЫ</span></div>
        `;

        if (distance < 0) {
            clearInterval(updateTimer);
            timerElement.innerHTML = `<div style="font-size:1.2em; color:#00ffcc;">С НОВЫМ ГОДОМ, BEAMTOWN!</div>`;
        }
    }, 1000);
}

// Генерация фоновых снежинок 
function createSnowflake() {
  const snowflake = document.createElement('div');
  snowflake.classList.add('snowflake');
  snowflake.innerHTML = '❄'; 
  snowflake.style.left = Math.random() * 100 + 'vw';
  snowflake.style.animationDuration = Math.random() * 3 + 7 + 's'; 
  snowflake.style.animationDelay = Math.random() * 5 + 's';
  snowflake.style.opacity = Math.random();
  snowflake.style.fontSize = Math.random() * 1.5 + 0.8 + 'em'; 
  document.body.appendChild(snowflake);

  snowflake.addEventListener('animationend', () => {
    snowflake.remove();
    createSnowflake(); 
  });
}

for (let i = 0; i < 50; i++) {
  createSnowflake();
}

// --- ЛОГИКА ТАЙНОГО ПОДАРКА (УНИКАЛЬНЫЙ КОД) ---
function generateUniqueCode() {
    // Генерируем уникальную часть: 5 случайных цифр + HEX-метка времени
    const randomPart = Math.floor(Math.random() * 99999).toString().padStart(5, '0');
    const timestampHex = new Date().getTime().toString(16).toUpperCase(); 
    return `BT-NY${randomPart}-${timestampHex.slice(-5)}`; // Используем часть HEX-метки
}

function showGiftModal() {
    // 1. Генерируем и вставляем уникальный код
    const uniqueCode = generateUniqueCode();
    document.getElementById('secret-code').innerText = uniqueCode;

    // 2. Показываем модальное окно
    document.getElementById('gift-modal').classList.add('show');
    startMusic(); 
}


// --- ЛОГИКА ВИКТОРИНЫ ПО BEAMNG.DRIVE ---
const quizData = [
    {
        question: "Какой из этих автомобилей является стандартным американским маслкаром в BeamNG.drive?",
        answers: [
            { text: "Burnside Special", isCorrect: false },
            { text: "Gavril Barstow", isCorrect: true },
            { text: "Ibishu Covet", isCorrect: false }
        ]
    },
    {
        question: "Какая функция BeamNG.drive позволяет замедлить время для детального просмотра краша?",
        answers: [
            { text: "Free Cam", isCorrect: false },
            { text: "Slow-Motion", isCorrect: true },
            { text: "Replay Mode", isCorrect: false }
        ]
    },
    {
        question: "Название какой карты переводится как 'Восточное Побережье США'?",
        answers: [
            { text: "Gridmap", isCorrect: false },
            { text: "Industrial Site", isCorrect: false },
            { text: "East Coast, USA", isCorrect: true }
        ]
    },
    {
        question: "Какая клавиша по умолчанию активирует 'замедленное время' (Slow-Motion)?",
        answers: [
            { text: "J", isCorrect: false },
            { text: "Alt + Стрелка вниз", isCorrect: false },
            { text: "Ctrl + Стрелка вниз", isCorrect: true }
        ]
    },
    {
        question: "Какая клавиша по умолчанию отвечает за 'Ручной тормоз' (Handbrake)?",
        answers: [
            { text: "Пробел (Space)", isCorrect: true },
            { text: "Shift", isCorrect: false },
            { text: "Z", isCorrect: false }
        ]
    },
    {
        question: "Какой автомобиль в BeamNG является компактным японским хэтчбеком?",
        answers: [
            { text: "Bruckell LeGran", isCorrect: false },
            { text: "Ibishu Covet", isCorrect: true },
            { text: "Soliad Wendover", isCorrect: false }
        ]
    },
    {
        question: "Что в BeamNG.drive означает аббревиатура 'JBEAM'?",
        answers: [
            { text: "Название главного разработчика", isCorrect: false },
            { text: "Система моделирования мягких тел (Soft-body physics)", isCorrect: true },
            { text: "Инструмент для создания карт", isCorrect: false }
        ]
    },
    {
        question: "Какая карта была самой первой в игре?",
        answers: [
            { text: "Industrial Site", isCorrect: false },
            { text: "Grid Map", isCorrect: true },
            { text: "West Coast, USA", isCorrect: false }
        ]
    },
    {
        question: "Какой автомобиль считается стандартным пикапом (траком)?",
        answers: [
            { text: "Gavril Roamer", isCorrect: false },
            { text: "Gavril D-Series", isCorrect: true },
            { text: "Ibishu Pessima", isCorrect: false }
        ]
    },
    {
        question: "Какая клавиша позволяет сбросить положение автомобиля в его последнюю точку?",
        answers: [
            { text: "Insert", isCorrect: true },
            { text: "F9", isCorrect: false },
            { text: "Home", isCorrect: false }
        ]
    },
    {
        question: "Какой самый большой островной регион доступен в игре?",
        answers: [
            { text: "Industrial Site", isCorrect: false },
            { text: "Italy", isCorrect: true },
            { text: "Jungle Rock Island", isCorrect: false }
        ]
    },
    {
        question: "Что означает параметр 'Drivetrain' (Привод)?",
        answers: [
            { text: "Тип шин", isCorrect: false },
            { text: "Расположение ведущих колёс", isCorrect: true },
            { text: "Тип подвески", isCorrect: false }
        ]
    },
    {
        question: "Какая клавиша включает/выключает 'Свободную камеру' (Free Cam)?",
        answers: [
            { text: "F4", isCorrect: false },
            { text: "Shift + C", isCorrect: false },
            { text: "Shift + C (или F7)", isCorrect: true }
        ]
    },
    {
        question: "Как называется функция, позволяющая заблокировать дифференциал?",
        answers: [
            { text: "Torque Control", isCorrect: false },
            { text: "Diff Lock", isCorrect: true },
            { text: "Stability Control", isCorrect: false }
        ]
    },
    {
        question: "Какое название носит гоночный седан среднего размера?",
        answers: [
            { text: "Hirochi SBR4", isCorrect: false },
            { text: "ETK 800 Series", isCorrect: true },
            { text: "Civetta Bolide", isCorrect: false }
        ]
    },
    {
        question: "Что произойдет, если нажать 'Q'?",
        answers: [
            { text: "Включится зажигание", isCorrect: false },
            { text: "Автомобиль 'подпрыгнет'", isCorrect: true },
            { text: "Включится ручной тормоз", isCorrect: false }
        ]
    },
    {
        question: "Какой тип транспортного средства представляет собой 'Wentward Bus'?",
        answers: [
            { text: "Школьный автобус", isCorrect: false },
            { text: "Городской/пригородный автобус", isCorrect: true },
            { text: "Туристический автобус", isCorrect: false }
        ]
    },
    {
        question: "Какой автомобиль является суперкаром из 70-х годов?",
        answers: [
            { text: "Bruckell LeGran", isCorrect: false },
            { text: "Civetta Bolide", isCorrect: true },
            { text: "Hirochi Sunburst", isCorrect: false }
        ]
    },
    {
        question: "Какой режим игры включает в себя доставку грузов на время?",
        answers: [
            { text: "Time Trial", isCorrect: false },
            { text: "Missions / Scenarios", isCorrect: true },
            { text: "Chase Mode", isCorrect: false }
        ]
    },
    {
        question: "Для чего используется меню 'Parts Editor' (Ctrl+W)?",
        answers: [
            { text: "Для изменения погоды", isCorrect: false },
            { text: "Для настройки деталей и тюнинга авто", isCorrect: true },
            { text: "Для загрузки новых карт", isCorrect: false }
        ]
    },
    {
        question: "Какая клавиша позволяет мгновенно починить автомобиль (Reset Vehicle)?",
        answers: [
            { text: "R", isCorrect: true },
            { text: "P", isCorrect: false },
            { text: "F5", isCorrect: false }
        ]
    },
    {
        question: "Какой европейский спорткар имеет турбированный оппозитный двигатель?",
        answers: [
            { text: "Civetta Bolide", isCorrect: false },
            { text: "Hirochi SBR4", isCorrect: true },
            { text: "ETK K-Series", isCorrect: false }
        ]
    }
];

let currentQuestionIndex = 0;
let score = 0;
let quizAnswered = false; 

const quizModal = document.getElementById('quiz-modal');
const quizQuestionContainer = document.getElementById('quiz-question-container');
const nextQuizBtn = document.getElementById('next-quiz-btn');
const snowTransition = document.getElementById('snow-transition'); 

function showQuestion(index) {
    const q = quizData[index];
    quizQuestionContainer.innerHTML = `
        <h3>Вопрос ${index + 1} из ${quizData.length}: ${q.question}</h3>
        <div class="options-container quiz-options">
            ${q.answers.map((ans, i) => 
                `<button data-correct="${ans.isCorrect}" data-index="${i}">${ans.text}</button>`
            ).join('')}
        </div>
    `;
    nextQuizBtn.style.display = 'none';
    quizAnswered = false;
    attachQuizListeners();
}

function attachQuizListeners() {
    const buttons = quizQuestionContainer.querySelectorAll('button');
    buttons.forEach(button => {
        button.addEventListener('click', handleAnswerClick);
    });
}

function handleAnswerClick(event) {
    if (quizAnswered) return;
    
    quizAnswered = true;
    startMusic(); 

    const selectedButton = event.target;
    const isCorrect = selectedButton.dataset.correct === 'true';

    if (isCorrect) {
        selectedButton.classList.add('correct');
        score++;
    } else {
        selectedButton.classList.add('incorrect');
        quizQuestionContainer.querySelector('button[data-correct="true"]').classList.add('correct');
    }

    quizQuestionContainer.querySelectorAll('button').forEach(btn => btn.classList.add('disabled'));
    nextQuizBtn.style.display = 'block';
}

function showQuizResult() {
    quizQuestionContainer.innerHTML = `
        <h3>Тест завершен!</h3>
        <p style="font-size:1.4em;">Ваш результат: <strong>${score} из ${quizData.length}</strong></p>
        <p style="color:#00ffcc; font-size:1.2em;">
            ${score === quizData.length ? '👑 Абсолютно безупречно! Вы — главный эксперт BeamNG!' : 
             score >= 20 ? '🔥 Потрясающе! Вы знаете BeamNG как свои пять пальцы.' : 
             score >= 10 ? '⭐ Отличный результат! У вас хорошие знания игры.' : 
             '🧐 Похоже, вам нужно больше времени провести за рулем!'
            }
        </p>
        <button onclick="closeModal('quiz-modal')" style="background:#673ab7; color:white; margin-top:20px;">Закрыть</button>
    `;
    nextQuizBtn.style.display = 'none';
}

// Обработчик кнопки "Следующий вопрос"
nextQuizBtn.onclick = () => {
    currentQuestionIndex++;
    if (currentQuestionIndex < quizData.length) {
        showQuestion(currentQuestionIndex);
    } else {
        showQuizResult();
    }
};

// --- ФУНКЦИИ ОТКРЫТИЯ/ЗАКРЫТИЯ МОДАЛЬНЫХ ОКОН ---

function closeModal(id) {
    const modal = document.getElementById(id);
    modal.style.opacity = 0;
    modal.style.transform = 'scale(1.2)';
    setTimeout(() => {
        modal.classList.remove('show');
        modal.style.opacity = 0;
        modal.style.transform = 'scale(0.8)'; 
    }, 700);
}

// Логика для открытия опроса
function showSurvey() {
    const surveyModal = document.getElementById('survey-modal');
    surveyModal.classList.add('show');

    document.querySelectorAll('.survey-btn').forEach(button => {
        button.addEventListener('click', (event) => {
            console.log("Пользователь выбрал источник:", event.target.getAttribute('data-source'));
            startMusic();
            closeModal('survey-modal');
        });
    });
}


// --- ЛОГИКА МЕТЕЛИ ---

const TRANSITION_DURATION = 4000; 

function createBlizzardFlake() {
    const flake = document.createElement('div');
    flake.classList.add('blizzard-flake');
    flake.innerHTML = ['❅', '❄', '❆', '•'][Math.floor(Math.random() * 4)]; 
    
    flake.style.left = Math.random() * 100 + 'vw';
    flake.style.top = -Math.random() * 50 + 'vh'; 
    flake.style.fontSize = Math.random() * 6 + 3 + 'em'; 
    flake.style.animationDuration = Math.random() * 1 + 4 + 's'; 
    flake.style.animationDelay = Math.random() * (TRANSITION_DURATION / 1000) * 0.9 + 's'; 
    
    snowTransition.appendChild(flake);
}

/**
 * Запускает эффект метели и выполняет callback после завершения основного цикла.
 * @param {function} callback - Функция, которая будет вызвана после появления метели.
 */
function startBlizzardTransition(callback) {
    snowTransition.innerHTML = '';
    snowTransition.classList.remove('fade-out');
    snowTransition.classList.add('active');
    
    // Запуск снежинок
    const numFlakes = 150; 
    for (let i = 0; i < numFlakes; i++) {
        createBlizzardFlake();
    }
    
    // 1. Ожидаем завершения основного цикла метели
    setTimeout(() => {
        snowTransition.classList.add('fade-out');
        
        // 2. Вызываем callback (показ модального окна)
        if (callback) {
            callback();
            // Скрываем модальный контент перед показом, чтобы эффект был заметнее
            document.querySelector('.modal-overlay.show .modal-content').style.opacity = '0'; 
            setTimeout(() => {
                 document.querySelector('.modal-overlay.show .modal-content').style.opacity = '1';
                 document.querySelector('.modal-overlay.show .modal-content').style.transition = 'opacity 0.5s ease-in';
            }, 300); 
        }
        
        // 3. Очищаем DOM после завершения исчезновения
        setTimeout(() => {
            snowTransition.innerHTML = ''; 
            snowTransition.classList.remove('active');
            
        }, 1200); 
        
    }, TRANSITION_DURATION); 
}

// ГЛАВНЫЙ ОБРАБОТЧИК КНОПКИ ВИКТОРИНЫ (Использует метель)
document.getElementById('open-quiz-btn').onclick = () => {
    startBlizzardTransition(() => {
        currentQuestionIndex = 0; 
        score = 0;
        showQuestion(currentQuestionIndex); // Показываем первый вопрос
        document.getElementById('quiz-modal').classList.add('show');
    });
};

// ОБРАБОТЧИК КНОПКИ ПОДАРКА (Использует метель)
document.getElementById('open-gift-btn').onclick = () => {
    startBlizzardTransition(() => {
        showGiftModal(); 
    });
};

</script>
</body>
</html>